<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Nutrition Tracker</title>
  <style>
    body {
      font-family: Arial, sans-serif;
      margin: 0;
      padding: 0;
    }

    header {
      background-color: #4CAF50;
      color: white;
      padding: 1rem;
      text-align: center;
    }

    .tabs {
      display: flex;
      background-color: #f1f1f1;
    }

    .tab-button {
      flex: 1;
      padding: 1rem;
      cursor: pointer;
      text-align: center;
      background-color: #ddd;
      border: none;
      outline: none;
    }

    .tab-button.active {
      background-color: #bbb;
      font-weight: bold;
    }

    .tab-content {
      display: none;
      padding: 1rem;
    }

    .tab-content.active {
      display: block;
    }

    select, input, button, textarea {
      display: block;
      margin: 1rem 0;
      padding: 0.5rem;
      width: 100%;
      max-width: 500px;
    }

    .selected-foods {
      display: flex;
      flex-direction: column;
      gap: 0.5rem;
    }

    .food-tag {
      background-color: #e0e0e0;
      padding: 0.4rem 0.8rem;
      border-radius: 8px;
      display: flex;
      justify-content: space-between;
      align-items: center;
      max-width: 500px;
    }

    .food-controls {
      display: flex;
      gap: 0.5rem;
      align-items: center;
    }

    .food-controls button {
      padding: 0.2rem 0.6rem;
      font-size: 1rem;
      cursor: pointer;
    }

    table {
      border-collapse: collapse;
      width: 100%;
      max-width: 800px;
      margin-top: 1rem;
    }

    th, td {
      border: 1px solid #ccc;
      padding: 0.5rem;
      text-align: center;
    }

    @media (max-width: 600px) {
      .tabs {
        flex-direction: column;
      }
    }
  </style>
</head>
<body>

<header>
  <h1>Nutrition App</h1>
</header>

<div class="tabs">
  <button class="tab-button active" onclick="showTab('tracker')">Nutrition Tracker</button>
  <button class="tab-button" onclick="showTab('custom')">Add Custom Food</button>
</div>

<div id="tracker" class="tab-content active">
  <h2>Nutrition Tracker</h2>
  <label for="foodSelect">Select foods:</label>
  <select id="foodSelect">
    <option value="">-- Choose a food --</option>
    <option value="raspberry_bar">Raspberry Bar</option>
    <option value="bp_longevity_mix">bp_longevity_mix</option>
    <option value="bp_longevity_protein">bp_longevity_protein</option>
    <option value="bp_longevity_protein_with_super_shrooms">bp_longevity_protein_with_super_shrooms</option>
    <option value="bp_teriyaki_beef">Blueprint Teriyaki Beef</option>
  </select>

  <div class="selected-foods" id="selectedFoods"></div>

  <button onclick="updateNutrition()">Update Nutrition</button>

  <table id="nutritionTable" style="display:none;">
    <thead>
      <tr>
        <th>Nutrient</th>
        <th>Your Intake</th>
        <th>FDA Daily Limit</th>
      </tr>
    </thead>
    <tbody id="nutritionBody"></tbody>
  </table>
</div>

<div id="custom" class="tab-content">
  <h2>Add Custom Food</h2>
  <form id="customFoodForm">
    <input type="text" id="foodName" placeholder="Food Name" required />
    <input type="number" min="0" id="calories" placeholder="Calories" required />
    <input type="number" min="0" id="protein" placeholder="Protein (g)" required />
    <input type="number" min="0" id="carbs" placeholder="Carbohydrates (g)" required />
    <input type="number" min="0" id="total_fat" placeholder="Total Fat (g)" required />
    <input type="number" min="0" id="saturated_fat" placeholder="Saturated Fat (g)" required />
    <input type="number" min="0" id="fiber" placeholder="Fiber (g)" required />
    <input type="number" min="0" id="sugar" placeholder="Sugar (g)" required />
    <input type="number" min="0" id="sodium" placeholder="Sodium (mg)" required />
    <button type="submit">Generate JSON</button>
  </form>

  <textarea id="jsonOutput" rows="10" readonly placeholder="JSON will appear here..."></textarea>
  <button onclick="copyJSON()">Copy to Clipboard</button>
  <p><em>Copy this JSON and manually add it to your foods list in your app repo.</em></p>
</div>

<script>
  const nutrients = ['calories', 'protein', 'carbs', 'total_fat', 'saturated_fat', 'fiber', 'sugar', 'sodium'];

  const fdaLimits = {
    calories: 2700,
    protein: 75,          // 10-35% of calories (aim for higher if active)
    carbs: 412,           // 45-65% of calories
    total_fat: 117,       // 20-35% of calories
    saturated_fat: 30,    // Limit to <10% of calories (~30g)
    fiber: 34,            // Higher for men under 50
    sugar: 50,           // Keep added sugar <10% (~75g max)
    sodium: 2300          // Same (donâ€™t go over)
  };

  const foodData = {
    bp_longevity_mix: {
      name: "Blueprint Longevity Mix",
      calories: 110,
      protein: 20,
      carbs: 3,
      total_fat: 0,
      saturated_fat: 0,
      fiber: 0,
      sugar: 0,
      sodium: 0
    },
    bp_longevity_protein: {
      name: "Blueprint Longevity Protein",
      calories: 845,
      protein: 32,
      carbs: 29,
      total_fat: 74,
      saturated_fat: 12,
      fiber: 7,
      sugar: 6,
      sodium: 215
    },
    bp_longevity_protein_with_super_shrooms: {
      name: "Blueprint Longevity Protein With Super Shrooms",
      calories: 860,
      protein: 32,
      carbs: 33,
      total_fat: 74,
      saturated_fat: 12,
      fiber: 9,
      sugar: 6,
      sodium: 265
    },
    raspberry_bar: {
      name: "Raspberry Bar",
      calories: 160,
      protein: 9,
      carbs: 4,
      total_fat: 12,
      saturated_fat: 0, // ?
      fiber: 1,
      sugar: 1,
      sodium: 190
    },
    bp_teriyaki_beef: {
      name: "Blueprint Teriyaki Beef",
      calories: 324,
      protein: 29,
      carbs: 25,
      total_fat: 13,
      saturated_fat: 3,
      fiber: 7,
      sugar: 9,
      sodium: 268
    },
  };

  // Selected foods and quantities
  let selectedFoods = {};

  function showTab(tabId) {
    document.querySelectorAll('.tab-button').forEach(btn => btn.classList.remove('active'));
    document.querySelectorAll('.tab-content').forEach(tab => tab.classList.remove('active'));
    document.querySelector(`.tab-button[onclick="showTab('${tabId}')"]`).classList.add('active');
    document.getElementById(tabId).classList.add('active');
  }

  document.getElementById('foodSelect').addEventListener('change', function () {
    const food = this.value;
    if (food) {
      if (!selectedFoods[food]) {
        selectedFoods[food] = 1;
      } else {
        selectedFoods[food] += 1;
      }
      renderSelectedFoods();
    }
    this.value = '';
  });

  function renderSelectedFoods() {
    const container = document.getElementById('selectedFoods');
    container.innerHTML = '';

    Object.entries(selectedFoods).forEach(([food, qty]) => {
      const tag = document.createElement('div');
      tag.className = 'food-tag';

      const name = document.createElement('span');
      name.textContent = `${foodData[food]?.name || food} (x${qty})`;

      const controls = document.createElement('div');
      controls.className = 'food-controls';

      const plusBtn = document.createElement('button');
      plusBtn.textContent = '+';
      plusBtn.onclick = () => {
        selectedFoods[food]++;
        renderSelectedFoods();
      };

      const minusBtn = document.createElement('button');
      minusBtn.textContent = '-';
      minusBtn.onclick = () => {
        selectedFoods[food]--;
        if (selectedFoods[food] <= 0) delete selectedFoods[food];
        renderSelectedFoods();
      };

      controls.appendChild(minusBtn);
      controls.appendChild(plusBtn);

      tag.appendChild(name);
      tag.appendChild(controls);
      container.appendChild(tag);
    });
  }

  function formatNutrientName(name) {
    return name
      .split('_')
      .map(word => word.charAt(0).toUpperCase() + word.slice(1))
      .join(' ');
  }


  function updateNutrition() {
    const totals = {};
    nutrients.forEach(n => totals[n] = 0);

    Object.entries(selectedFoods).forEach(([food, qty]) => {
      const data = foodData[food];
      if (data) {
        nutrients.forEach(n => {
          totals[n] += (data[n] || 0) * qty;
        });
      }
    });

    const tbody = document.getElementById('nutritionBody');
    tbody.innerHTML = '';

    nutrients.forEach(nutrient => {
      const tr = document.createElement('tr');
      tr.innerHTML = `
        <td>${formatNutrientName(nutrient)}</td>
        <td>${totals[nutrient].toFixed(1)}</td>
        <td>${fdaLimits[nutrient]}</td>
      `;
      tbody.appendChild(tr);
    });

    document.getElementById('nutritionTable').style.display = 'table';
  }

  document.getElementById('customFoodForm').addEventListener('submit', function(e) {
    e.preventDefault();

    const food = {
      name: document.getElementById('foodName').value.trim()
    };

    let isValid = food.name.length > 0;

    nutrients.forEach(nutrient => {
      const value = parseFloat(document.getElementById(nutrient).value);
      if (isNaN(value) || value < 0) isValid = false;
      food[nutrient] = value;
    });

    if (!isValid) {
      alert("Please fill out all fields with valid (non-negative) numbers.");
      return;
    }

    const json = JSON.stringify(food, null, 2);
    document.getElementById('jsonOutput').value = json;
  });

  function copyJSON() {
    const text = document.getElementById('jsonOutput').value;
    navigator.clipboard.writeText(text)
      .then(() => alert('JSON copied to clipboard!'))
      .catch(err => alert('Failed to copy JSON: ' + err));
  }
</script>

</body>
</html>
